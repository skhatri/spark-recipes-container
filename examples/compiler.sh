#!/usr/bin/env bash
CP="."

CP="${CP}:libs/scala-compiler-2.12.11.jar:libs/spark-sql_2.12-3.0.0.jar:libs/spark-kubernetes_2.12-3.0.0.jar:libs/spark-streaming_2.12-3.0.0.jar:libs/spark-catalyst_2.12-3.0.0.jar:libs/spark-core_2.12-3.0.0.jar:libs/jackson-module-scala_2.12-2.11.2.jar:libs/spark-cassandra-connector_2.12-3.0.0-beta.jar:libs/spark-cassandra-connector-driver_2.12-3.0.0-beta.jar:libs/scala-reflect-2.12.11.jar:libs/scala-xml_2.12-1.2.0.jar:libs/spark-unsafe_2.12-3.0.0.jar:libs/chill_2.12-0.9.5.jar:libs/spark-network-shuffle_2.12-3.0.0.jar:libs/spark-network-common_2.12-3.0.0.jar:libs/json4s-jackson_2.12-3.6.6.jar:libs/spark-streaming-kafka-0-10_2.12-3.0.0.jar:libs/spark-launcher_2.12-3.0.0.jar:libs/spark-kvstore_2.12-3.0.0.jar:libs/spark-sketch_2.12-3.0.0.jar:libs/spark-token-provider-kafka-0-10_2.12-3.0.0.jar:libs/spark-tags_2.12-3.0.0.jar:libs/spark-tags_2.12-3.0.0-tests.jar:libs/json4s-core_2.12-3.6.6.jar:libs/scala-parser-combinators_2.12-1.1.2.jar:libs/json4s-ast_2.12-3.6.6.jar:libs/json4s-scalap_2.12-3.6.6.jar:libs/scala-library-2.12.11.jar:libs/jcc-11.5.4.0.jar:libs/postgresql-42.2.14.jar:libs/aws-java-sdk-s3-1.11.839.jar:libs/jackson-dataformat-yaml-2.11.2.jar:libs/snakeyaml-1.26.jar:libs/metrics-json-4.1.1.jar:libs/aws-java-sdk-kms-1.11.839.jar:libs/aws-java-sdk-core-1.11.839.jar:libs/jmespath-java-1.11.839.jar:libs/jackson-module-paranamer-2.11.2.jar:libs/jackson-databind-2.11.2.jar:libs/avro-mapred-1.8.2-hadoop2.jar:libs/avro-ipc-1.8.2.jar:libs/hadoop-client-2.7.4.jar:libs/hadoop-common-2.7.4.jar:libs/avro-1.8.2.jar:libs/paranamer-2.8.jar:libs/chill-java-0.9.5.jar:libs/xbean-asm7-shaded-4.15.jar:libs/hadoop-mapreduce-client-app-2.7.4.jar:libs/hadoop-mapreduce-client-jobclient-2.7.4.jar:libs/hadoop-mapreduce-client-shuffle-2.7.4.jar:libs/hadoop-mapreduce-client-common-2.7.4.jar:libs/hadoop-mapreduce-client-core-2.7.4.jar:libs/hadoop-yarn-client-2.7.4.jar:libs/hadoop-yarn-server-nodemanager-2.7.4.jar:libs/hadoop-yarn-server-common-2.7.4.jar:libs/hadoop-yarn-common-2.7.4.jar:libs/jaxb-api-2.2.2.jar:libs/activation-1.1.1.jar:libs/curator-recipes-2.7.1.jar:libs/hadoop-auth-2.7.4.jar:libs/curator-framework-2.7.1.jar:libs/curator-client-2.7.1.jar:libs/zookeeper-3.4.14.jar:libs/javax.servlet-api-3.1.0.jar:libs/commons-text-1.6.jar:libs/commons-lang3-3.9.jar:libs/commons-math3-3.4.1.jar:libs/arrow-vector-0.15.1.jar:libs/arrow-memory-0.15.1.jar:libs/java-driver-core-shaded-4.7.2.jar:libs/java-driver-mapper-runtime-4.7.2.jar:libs/java-driver-query-builder-4.7.2.jar:libs/spotbugs-annotations-3.1.12.jar:libs/jsr305-3.0.2.jar:libs/jul-to-slf4j-1.7.30.jar:libs/jcl-over-slf4j-1.7.30.jar:libs/slf4j-log4j12-1.7.30.jar:libs/stream-2.9.6.jar:libs/metrics-jvm-4.1.1.jar:libs/metrics-graphite-4.1.1.jar:libs/metrics-jmx-4.1.1.jar:libs/metrics-core-4.1.1.jar:libs/orc-core-1.5.10.jar:libs/hive-storage-api-2.7.1.jar:libs/kubernetes-client-4.9.2.jar:libs/kafka-clients-2.4.1.jar:libs/orc-shims-1.5.10.jar:libs/parquet-hadoop-1.10.1.jar:libs/parquet-column-1.10.1.jar:libs/parquet-encoding-1.10.1.jar:libs/parquet-common-1.10.1.jar:libs/parquet-format-2.4.0.jar:libs/apacheds-kerberos-codec-2.0.0-M15.jar:libs/apacheds-i18n-2.0.0-M15.jar:libs/api-asn1-api-1.0.0-M20.jar:libs/api-util-1.0.0-M20.jar:libs/slf4j-api-1.7.30.jar:libs/hadoop-hdfs-2.7.4.jar:libs/log4j-1.2.17.jar:libs/compress-lzf-1.0.3.jar:libs/snappy-java-1.1.7.5.jar:libs/lz4-java-1.7.1.jar:libs/zstd-jni-1.4.4-3.jar:libs/RoaringBitmap-0.7.45.jar:libs/commons-net-3.1.jar:libs/jersey-container-servlet-2.30.jar:libs/jersey-container-servlet-core-2.30.jar:libs/jersey-server-2.30.jar:libs/jersey-client-2.30.jar:libs/jersey-hk2-2.30.jar:libs/jersey-media-jaxb-2.30.jar:libs/jersey-common-2.30.jar:libs/netty-all-4.1.47.Final.jar:libs/ivy-2.4.0.jar:libs/oro-2.0.8.jar:libs/pyrolite-4.30.jar:libs/py4j-0.10.9.jar:libs/commons-crypto-1.0.0.jar:libs/unused-1.0.0.jar:libs/univocity-parsers-2.8.3.jar:libs/orc-mapreduce-1.5.10.jar:libs/jackson-annotations-2.11.2.jar:libs/jackson-dataformat-cbor-2.6.7.jar:libs/jackson-core-2.11.2.jar:libs/jackson-mapper-asl-1.9.13.jar:libs/jackson-jaxrs-1.9.13.jar:libs/jackson-xc-1.9.13.jar:libs/jackson-core-asl-1.9.13.jar:libs/commons-compress-1.8.1.jar:libs/xz-1.5.jar:libs/httpclient-4.5.9.jar:libs/commons-httpclient-3.1.jar:libs/commons-codec-1.11.jar:libs/kryo-shaded-4.0.2.jar:libs/hadoop-yarn-api-2.7.4.jar:libs/hadoop-annotations-2.7.4.jar:libs/leveldbjni-all-1.8.jar:libs/guava-16.0.1.jar:libs/audience-annotations-0.5.0.jar:libs/netty-3.10.6.Final.jar:libs/shims-0.7.45.jar:libs/jakarta.ws.rs-api-2.1.6.jar:libs/hk2-locator-2.6.1.jar:libs/hk2-api-2.6.1.jar:libs/hk2-utils-2.6.1.jar:libs/jakarta.inject-2.6.1.jar:libs/jakarta.annotation-api-1.3.5.jar:libs/osgi-resource-locator-1.0.3.jar:libs/jakarta.validation-api-2.0.2.jar:libs/javassist-3.25.0-GA.jar:libs/janino-3.0.16.jar:libs/commons-compiler-3.0.16.jar:libs/antlr4-runtime-4.7.1.jar:libs/protobuf-java-2.5.0.jar:libs/commons-configuration-1.6.jar:libs/commons-lang-2.6.jar:libs/aircompressor-0.10.jar:libs/threeten-extra-1.5.0.jar:libs/parquet-jackson-1.10.1.jar:libs/kubernetes-model-4.9.2.jar:libs/logging-interceptor-3.12.6.jar:libs/okhttp-3.12.6.jar:libs/jackson-datatype-jsr310-2.10.3.jar:libs/zjsonpatch-0.3.0.jar:libs/generex-1.0.2.jar:libs/commons-logging-1.2.jar:libs/ion-java-1.0.2.jar:libs/joda-time-2.8.1.jar:libs/minlog-1.3.0.jar:libs/objenesis-2.5.1.jar:libs/commons-cli-1.2.jar:libs/xmlenc-0.52.jar:libs/commons-io-2.4.jar:libs/commons-collections-3.2.2.jar:libs/jetty-sslengine-6.1.26.jar:libs/jsp-api-2.1.jar:libs/gson-2.2.4.jar:libs/htrace-core-3.1.0-incubating.jar:libs/jetty-util-6.1.26.jar:libs/xercesImpl-2.9.1.jar:libs/aopalliance-repackaged-2.6.1.jar:libs/arrow-format-0.15.1.jar:libs/flatbuffers-java-1.9.0.jar:libs/kubernetes-model-common-4.9.2.jar:libs/jackson-module-jaxb-annotations-2.10.3.jar:libs/okio-1.15.0.jar:libs/automaton-1.11-8.jar:libs/native-protocol-1.4.10.jar:libs/java-driver-shaded-guava-25.1-jre-graal-sub-1.jar:libs/config-1.3.4.jar:libs/HdrHistogram-2.1.11.jar:libs/javatuples-1.2.jar:libs/reactive-streams-1.0.2.jar:libs/jcip-annotations-1.0-1.jar:libs/httpcore-4.4.11.jar:libs/commons-digester-1.8.jar:libs/jline-0.9.94.jar:libs/xml-apis-1.3.04.jar:libs/guice-3.0.jar:libs/jakarta.xml.bind-api-2.3.2.jar:libs/jakarta.activation-api-1.2.1.jar:libs/commons-beanutils-1.7.0.jar:libs/jettison-1.1.jar:libs/stax-api-1.0-2.jar:libs/javax.inject-1.jar:libs/aopalliance-1.0.jar:libs/cglib-2.2.1-v20090111.jar:libs/zinc_2.12-1.3.5.jar:libs/zinc-persist_2.12-1.3.5.jar:libs/zinc-core_2.12-1.3.5.jar:libs/zinc-compile-core_2.12-1.3.5.jar:libs/zinc-apiinfo_2.12-1.3.5.jar:libs/zinc-classfile_2.12-1.3.5.jar:libs/zinc-classpath_2.12-1.3.5.jar:libs/scalapb-runtime_2.12-0.6.0.jar:libs/util-logging_2.12-1.3.0.jar:libs/io_2.12-1.3.0.jar:libs/util-relation_2.12-1.3.0.jar:libs/sbinary_2.12-0.5.0.jar:libs/scala-parser-combinators_2.12-1.1.2.jar:libs/util-control_2.12-1.3.0.jar:libs/scala-compiler-2.12.10.jar:libs/lenses_2.12-0.4.12.jar:libs/fastparse_2.12-0.4.2.jar:libs/sjson-new-scalajson_2.12-0.8.3.jar:libs/sjson-new-core_2.12-0.8.3.jar:libs/scala-xml_2.12-1.0.6.jar:libs/scala-reflect-2.12.10.jar:libs/fastparse-utils_2.12-0.4.2.jar:libs/sourcecode_2.12-0.1.3.jar:libs/shaded-scalajson_2.12-1.0.0-M4.jar:libs/jawn-parser_2.12-0.10.4.jar:libs/scala-library-2.12.10.jar:libs/compiler-bridge_2.12-1.3.5.jar:libs/compiler-interface-1.3.5.jar:libs/protobuf-java-3.7.0.jar:libs/launcher-interface-1.0.0.jar:libs/util-interface-1.3.0.jar:libs/file-tree-views-2.1.3.jar:libs/jna-platform-4.5.0.jar:libs/jna-4.5.0.jar:libs/jline-2.14.6.jar:libs/log4j-core-2.11.2.jar:libs/log4j-api-2.11.2.jar:libs/disruptor-3.4.2.jar"

FILES=""
for f in $(find source -name "*.scala");
do
    FILES="$FILES $f"
done;

compile() {
    if [[ ! -d "out" ]];
    then
        mkdir out;
    fi;
    scalac -classpath ${CP} -d out ${FILES}
}

execute() {
    java -Xms1024m -Xmx2048m -classpath ${CP}:out $1
}

cmd=$1
args=$2
case $cmd in
    build)
    compile
    ;;
    run)
    execute $2
    ;;
    *)
    echo "unknown command"
    ;;
esac
